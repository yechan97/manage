<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>입출고 페이지</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap">
    <style>
        body, h1, select, input, textarea, button {
            font-family: 'Gowun Dodum', sans-serif;
        }
        .container { max-width: 800px; margin: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>입출고 페이지</h1>
        <!-- 이름 선택 -->
        <select id="name-select">
            <option>김수재</option>
            <option>문경훈</option>
            <option>직접입력</option>
        </select>
        <input type="text" id="custom-name" style="display:none" placeholder="이름 입력">
        <!-- 매트 종류, 색상, 수량 입력 -->
        <select id="mat-type">
            <option>일반</option>
            <option>리퍼브</option>
        </select>
        <input type="text" id="mat-name" placeholder="매트 종류">
        <input type="text" id="mat-color" placeholder="매트 색상">
        <input type="number" id="quantity" min="1" placeholder="수량">
        <!-- 비고 입력 -->
        <textarea id="notes" placeholder="비고 내용을 입력하세요"></textarea>
        <!-- 입고/출고 버튼 -->
        <button onclick="addEntry('입고')">입고</button>
        <button onclick="addEntry('출고')">출고</button>
        <div id="recent-entries"></div>
    </div>

    <script>
        // GitHub API 설정
        const GITHUB_USERNAME = 'yechan97';  // GitHub 사용자 이름
        const REPO_NAME = 'manage';      // 저장소 이름
        const FILE_PATH = 'data.json';            // 저장할 JSON 파일 경로
        const API_TOKEN = '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';           // 생성한 GitHub Personal Access Token
        const GITHUB_API_URL = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${FILE_PATH}`;

        // GitHub에서 데이터 불러오기
        async function loadDataFromGitHub() {
            try {
                const response = await fetch(GITHUB_API_URL, {
                    headers: { 'Authorization': `token ${API_TOKEN}` }
                });
                const fileData = await response.json();
                const content = atob(fileData.content);
                return JSON.parse(content);
            } catch (error) {
                console.error("데이터 불러오기 중 오류 발생:", error);
                alert("데이터 불러오기 중 문제가 발생했습니다.");
                return null;
            }
        }

        // GitHub에 데이터 저장하기
        async function saveDataToGitHub(data) {
            try {
                const response = await fetch(GITHUB_API_URL, {
                    headers: { 'Authorization': `token ${API_TOKEN}` }
                });
                const fileData = await response.json();
                const result = await fetch(GITHUB_API_URL, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${API_TOKEN}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: 'Update data.json',
                        content: btoa(JSON.stringify(data)),
                        sha: fileData.sha  // 기존 파일의 SHA 값 필요
                    })
                });

                if (result.ok) {
                    alert("데이터가 성공적으로 GitHub에 저장되었습니다!");
                } else {
                    console.error("GitHub API Error:", await result.json());
                    alert("데이터 저장 실패");
                }
            } catch (error) {
                console.error("데이터 저장 중 오류 발생:", error);
                alert("데이터 저장 중 문제가 발생했습니다.");
            }
        }

        // 데이터 추가 함수
        async function addEntry(type) {
            const name = document.getElementById('name-select').value;
            const matType = document.getElementById('mat-type').value;
            const matName = document.getElementById('mat-name').value;
            const matColor = document.getElementById('mat-color').value;
            const quantity = document.getElementById('quantity').value;
            const notes = document.getElementById('notes').value;

            const newEntry = { name, matType, matName, matColor, quantity, type, notes };
            let data = await loadDataFromGitHub();

            data.recentEntries.unshift(newEntry);  // 최근 내역에 추가

            await saveDataToGitHub(data);
        }

        // 데이터 불러오기 및 표시
        async function displayData() {
            const data = await loadDataFromGitHub();
            if (data) {
                document.getElementById('recent-entries').innerHTML = data.recentEntries
                    .map(entry => `<div>${entry.name} | ${entry.type} | ${entry.quantity}장</div>`)
                    .join('');
            }
        }

        // 페이지 로드 시 데이터 불러오기
        document.addEventListener('DOMContentLoaded', displayData);
    </script>
</body>
</html>
